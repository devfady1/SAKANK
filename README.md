# 🏠 سكنك - منصة حجز الشقق المتطورة

منصة ويب كاملة ومتطورة لحجز الشقق باللغة العربية مع دعم RTL، مبنية باستخدام Django 5 و Bootstrap 5 مع نظام إشعارات متقدم ونظام محادثة فوري.

## ✨ المميزات الرئيسية

### 🏠 للمستخدمين العاديين (المشترين)
- 🔍 **تصفح ذكي**: البحث والفلترة المتقدمة للشقق
- 🖼️ **معرض صور تفاعلي**: عرض تفاصيل الشقق مع صور عالية الجودة
- 🛏️ **حجز الأسرة**: نظام حجز سهل ومرن
- 💳 **دفع آمن**: نظام دفع متكامل مع Stripe
- 📊 **متابعة الحجوزات**: لوحة تحكم شخصية لمتابعة الحجوزات
- 💬 **نظام محادثة**: تواصل مباشر مع أصحاب الشقق
- 🔔 **إشعارات فورية**: تنبيهات للرسائل الجديدة والتحديثات

### 🏢 للبائعين (أصحاب الشقق)
- ✅ **نظام تحقق متقدم**: رفع البطاقة ووثيقة الملكية مع مراجعة إدارية
- 📋 **لوحة تحكم شاملة**: إدارة كاملة للشقق والحجوزات
- ➕ **إضافة شقق**: واجهة سهلة لإضافة شقق جديدة مع معرض صور
- 🏠 **إدارة الغرف والأسرة**: تحكم كامل في تفاصيل الشقة
- 💰 **متابعة الأرباح**: تقارير مالية مفصلة
- 💬 **محادثة العملاء**: نظام رسائل مع المستأجرين
- 📊 **إحصائيات متقدمة**: تحليلات الأداء والحجوزات
- 📄 **عقد إلزامي**: نظام موافقة على الشروط والأحكام

### 🛠️ المميزات التقنية المتطورة
- 🌐 **واجهة عربية كاملة**: دعم RTL مع تصميم متجاوب
- 📱 **متوافق مع الجوال**: تصميم responsive لجميع الأجهزة
- 🔐 **مصادقة متقدمة**: تسجيل دخول بـ Google + نظام تحقق بالبريد
- 💳 **دفع آمن**: تكامل كامل مع Stripe مع webhook
- 🔔 **نظام إشعارات متطور**: دعم المتصفحات و WebView للتطبيقات المحمولة
- 🎵 **إشعارات صوتية**: أصوات مخصصة للرسائل والتنبيهات
- ⚡ **Service Worker**: عمل في الخلفية وإشعارات push
- 🌙 **لوحة إدارة مظلمة**: واجهة إدارية عصرية مع Jazzmin

## 🚀 التقنيات المستخدمة

### Backend
- **Django 5.2** - إطار العمل الرئيسي
- **Python 3.10** - لغة البرمجة
- **SQLite** - قاعدة البيانات (قابلة للترقية لـ PostgreSQL)
- **Django Allauth** - نظام المصادقة المتقدم
- **Stripe API** - معالجة المدفوعات

### Frontend
- **Bootstrap 5 RTL** - إطار العمل للواجهة
- **HTML5, CSS3, JavaScript** - تقنيات الويب الأساسية
- **Responsive Design** - تصميم متجاوب
- **Progressive Web App** - ميزات تطبيق الويب المتقدم

### الميزات المتقدمة
- **Real-time Notifications** - إشعارات فورية
- **WebView Bridge** - دعم التطبيقات المحمولة
- **Service Worker** - عمل في الخلفية
- **Audio Notifications** - إشعارات صوتية
- **File Upload System** - نظام رفع الملفات المتقدم

## التثبيت والتشغيل

### المتطلبات
- Python 3.10 أو أحدث
- pip (مدير حزم Python)

### خطوات التثبيت

1. **استنساخ المشروع**
```bash
git clone <repository-url>
cd sakanak
```

2. **إنشاء البيئة الافتراضية**
```bash
python -m venv .venv
.venv\Scripts\activate  # Windows
# أو
source .venv/bin/activate  # Linux/Mac
```

3. **تثبيت المتطلبات**
```bash
pip install -r requirements.txt
```

4. **إعداد متغيرات البيئة**
```bash
# إنشاء ملف .env وتعديل القيم
cp .env.example .env
```

5. **إنشاء قاعدة البيانات**
```bash
python manage.py makemigrations
python manage.py migrate
```

6. **إنشاء مدير النظام**
```bash
python manage.py createsuperuser
```

7. **إنشاء البيانات التجريبية (اختياري)**
```bash
python create_sample_data.py
```

8. **تشغيل الخادم**
```bash
python manage.py runserver
```

الآن يمكنك الوصول للموقع على: http://127.0.0.1:8000

## إعداد Stripe

1. إنشاء حساب على [Stripe](https://stripe.com)
2. الحصول على مفاتيح API من لوحة تحكم Stripe
3. تحديث ملف `.env` بالمفاتيح:
```
STRIPE_PUBLIC_KEY=pk_test_your_key_here
STRIPE_SECRET_KEY=sk_test_your_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
```

## 📁 هيكل المشروع

```
sakanak/
├── 👥 accounts/              # إدارة المستخدمين والتحقق
│   ├── models.py            # نموذج المستخدم المخصص + التحقق
│   ├── views.py             # واجهات المصادقة والتحقق
│   ├── forms.py             # نماذج التسجيل والتحقق
│   └── middleware.py        # حماية صفحات البائعين
├── 🏠 listings/             # الشقق والغرف والأسرة
│   ├── models.py            # Location, Apartment, Room, Bed
│   ├── views.py             # عرض وإدارة الشقق
│   └── forms.py             # نماذج إضافة الشقق
├── 📅 bookings/             # نظام الحجوزات والمحادثة
│   ├── models.py            # Booking, Message
│   ├── views.py             # الحجوزات والمحادثة
│   └── forms.py             # نماذج الحجز والرسائل
├── 💳 payments/             # معالجة الدفعات
│   ├── models.py            # Payment, WebhookEvent
│   ├── views.py             # Stripe integration
│   └── webhooks.py          # معالجة أحداث Stripe
├── 📄 pages/                # الصفحات العامة
│   ├── models.py            # ContactMessage
│   └── views.py             # الصفحة الرئيسية والاتصال
├── 🎨 templates/            # قوالب HTML
│   ├── base.html            # القالب الأساسي
│   ├── account/             # قوالب المصادقة
│   ├── listings/            # قوالب الشقق
│   ├── bookings/            # قوالب الحجوزات والمحادثة
│   └── payments/            # قوالب الدفع
├── 📦 static/               # الملفات الثابتة
│   ├── css/                 # ملفات التنسيق
│   ├── js/                  # JavaScript متقدم
│   │   ├── notifications.js # نظام الإشعارات
│   │   ├── webview-bridge.js# دعم التطبيقات المحمولة
│   │   └── sw.js           # Service Worker
│   └── sounds/              # الأصوات للإشعارات
├── 📁 media/                # الملفات المرفوعة
│   ├── apartments/          # صور الشقق
│   ├── rooms/               # صور الغرف
│   └── verifications/       # وثائق التحقق
├── 📋 requirements.txt      # متطلبات المشروع
├── 🔧 manage.py            # أداة إدارة Django
├── 📖 README.md            # هذا الملف
├── 🔐 AUTHENTICATION_SETUP.md # دليل إعداد المصادقة
├── 🔔 NOTIFICATIONS_GUIDE.md  # دليل نظام الإشعارات
└── 💳 STRIPE_SETUP.md      # دليل إعداد Stripe
```

## 🗄️ النماذج الرئيسية

### 👤 User (المستخدم المخصص)
- **نوعان**: مشتري وبائع مع صلاحيات مختلفة
- **التحقق**: نظام تحقق متقدم للبائعين
- **العقد**: موافقة إلزامية على الشروط والأحكام
- **الحقول**: الهاتف، حالة التحقق، تاريخ الإنشاء
- **المصادقة**: دعم Google OAuth + البريد الإلكتروني

### 📍 Location (الموقع)
- **المواقع الثابتة**: قائمة محددة مسبقاً للشقق
- **التفاصيل**: اسم الموقع، المدينة، حالة النشاط
- **الترتيب**: مرتبة حسب المدينة والاسم

### 🏠 Apartment (الشقة)
- **المعلومات الأساسية**: الاسم، الوصف، الموقع
- **المالك**: مرتبطة بالبائع المتحقق
- **الصور**: صورة رئيسية + معرض صور إضافية
- **الحالة**: نشطة/غير نشطة مع تواريخ الإنشاء والتحديث

### 🚪 Room (الغرفة)
- **التفاصيل**: اسم/رقم الغرفة، عدد الأسرة
- **الوسائط**: صورة الغرفة مع وصف تفصيلي
- **الربط**: مرتبطة بالشقة مع قيد الفرادة

### 🛏️ Bed (السرير)
- **المعلومات**: رقم السرير، السعر الشهري
- **الحالات**: متاح، محجوز، صيانة
- **الربط**: مرتبط بالغرفة مع قيد الفرادة

### 📅 Booking (الحجز)
- **التفاصيل**: المستخدم، السرير، تواريخ البداية والنهاية
- **المالية**: السعر الشهري، المبلغ الإجمالي
- **الحالات**: في الانتظار، مؤكد، ملغي، مكتمل
- **الدفع**: ربط مع نظام Stripe للدفع الآمن

### 💬 Message (الرسائل)
- **المحادثة**: رسائل بين المستأجر وصاحب الشقة
- **التفاصيل**: المرسل، المستقبل، النص، التوقيت
- **الحالة**: مقروءة/غير مقروءة للإشعارات

### 💳 Payment (الدفعة)
- **Stripe Integration**: تكامل كامل مع نظام Stripe
- **التتبع**: معرف نية الدفع، معرف الشحن
- **المالية**: المبلغ، العملة، الرسوم، المبلغ الصافي
- **الحالات**: في الانتظار، قيد المعالجة، نجح، فشل، مسترد

### 🔔 WebhookEvent (أحداث Webhook)
- **Stripe Events**: معالجة أحداث Stripe التلقائية
- **التتبع**: معرف الحدث، النوع، البيانات
- **المعالجة**: حالة المعالجة مع الطوابع الزمنية

## بيانات تسجيل الدخول التجريبية

بعد تشغيل `create_sample_data.py`:

- **البائع**: `seller1` / `password123`
- **المشتري**: `buyer1` / `password123`
- **المدير**: `admin` / `admin123`

## 🌐 الصفحات والمسارات الرئيسية

### 🏠 الصفحات العامة
- **`/`** - الصفحة الرئيسية مع عرض الشقق المميزة
- **`/listings/`** - قائمة جميع الشقق مع البحث والفلترة
- **`/listings/apartment/<id>/`** - تفاصيل الشقة مع معرض الصور
- **`/contact/`** - صفحة التواصل

### 🔐 المصادقة والحسابات
- **`/accounts/login/`** - تسجيل الدخول (عادي + Google)
- **`/accounts/signup/`** - إنشاء حساب جديد
- **`/accounts/logout/`** - تسجيل الخروج
- **`/accounts/password/reset/`** - نسيان كلمة المرور
- **`/accounts/verification/`** - التحقق للبائعين (رفع الوثائق)

### 🏢 لوحة تحكم البائع
- **`/listings/seller/dashboard/`** - لوحة التحكم الرئيسية
- **`/listings/seller/apartments/`** - إدارة الشقق
- **`/listings/seller/add-apartment/`** - إضافة شقة جديدة
- **`/listings/seller/apartment/<id>/edit/`** - تعديل الشقة
- **`/listings/seller/bookings/`** - إدارة الحجوزات

### 📅 الحجوزات والمحادثة
- **`/bookings/my-bookings/`** - حجوزات المستخدم
- **`/bookings/book/<bed_id>/`** - صفحة الحجز
- **`/bookings/chat/<booking_id>/`** - المحادثة مع صاحب الشقة
- **`/bookings/user-chats/`** - قائمة جميع المحادثات

### 💳 الدفع والمدفوعات
- **`/payments/create-payment-intent/`** - إنشاء نية دفع
- **`/payments/confirm-payment/`** - تأكيد الدفع
- **`/payments/webhook/`** - استقبال أحداث Stripe
- **`/payments/success/`** - صفحة نجاح الدفع
- **`/payments/cancel/`** - صفحة إلغاء الدفع

### 🛠️ الإدارة
- **`/admin/`** - لوحة الإدارة (Jazzmin مع ثيم مظلم)

## الأمان

- حماية CSRF على جميع النماذج
- تشفير كلمات المرور
- تحقق من صحة البيانات
- حماية الملفات المرفوعة
- معالجة آمنة للدفعات

## المساهمة

1. Fork المشروع
2. إنشاء branch جديد (`git checkout -b feature/amazing-feature`)
3. Commit التغييرات (`git commit -m 'Add amazing feature'`)
4. Push للـ branch (`git push origin feature/amazing-feature`)
5. فتح Pull Request

## الترخيص

هذا المشروع مرخص تحت رخصة MIT - راجع ملف [LICENSE](LICENSE) للتفاصيل.

## الدعم

للحصول على الدعم أو الإبلاغ عن مشاكل:
- فتح issue على GitHub
- التواصل عبر البريد الإلكتروني: support@sakanak.com

## الإصدارات القادمة

- [ ] تطبيق موبايل
- [ ] نظام تقييمات ومراجعات
- [ ] خرائط تفاعلية
- [ ] نظام إشعارات
- [ ] تقارير مالية متقدمة
- [ ] دعم عملات متعددة
